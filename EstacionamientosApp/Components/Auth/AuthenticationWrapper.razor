@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime
@inject NavigationManager Navigation

@if (showContent)
{
    @ChildContent
}

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    
    private bool showContent = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await CheckAuthentication();
        }
    }

    private async Task CheckAuthentication()
    {
        try
        {
            // Pequeña pausa para asegurar que el DOM esté listo
            await Task.Delay(50);
            
            var authStatus = await JSRuntime.InvokeAsync<string>("sessionStorage.getItem", "isAuthenticated");
            
            if (string.IsNullOrEmpty(authStatus) || authStatus != "true")
            {
                // No está autenticado, redirigir al login inmediatamente
                Navigation.NavigateTo("/login", true);
                return;
            }

            // Está autenticado, mostrar el contenido
            showContent = true;
            StateHasChanged();
        }
        catch (Exception)
        {
            // Error al verificar autenticación, redirigir al login
            Navigation.NavigateTo("/login", true);
        }
    }
}